package types

import (
	"encoding/json"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/stretchr/testify/assert"
)

func TestUnmarshalingTransaction(t *testing.T) {
	// Test cases for marshaling and unmarshaling of transactions
	txJson := `{
		"blockHash": "0x9d6ac70a2bd9cfb15ae757061639e95f83c67210fb3ef12e437c9dca6230d0ed",
		"blockNumber": "0x12b557d",
		"from": "0x1114c78d5de672996d812dc2e1a05b5f33eacdfb",
		"gas": "0xc3500",
		"gasPrice": "0x55ea8ede6",
		"maxPriorityFeePerGas": "0x0",
		"maxFeePerGas": "0xd6ca652bf",
		"hash": "0x8dc203bf6083af1877db1812523674335dfedf65aaa6f1a3649aa51ecdac99e0",
		"input": "0x157dec6a6b7db761a5c9910ba8fcab98116d384b1b850667dfa04c19596f5aaff459fa38b0f7ed92f11ae6543784",
		"nonce": "0xdc3e",
		"to": "0x000000d40b595b94918a28b27d1e2c66f43a51d3",
		"transactionIndex": "0x40",
		"value": "0x1100c742403",
		"type": "0x2",
		"accessList": [
			{
				"address": "0x4c19596f5aaff459fa38b0f7ed92f11ae6543784",
				"storageKeys": [
					"0x6e41e0fbe643dfdb6043698bf865aada82dc46b953f754a3468eaa272a362dc7",
					"0x92b9e481a8783712fa635f342ee652fdd5ba432bb722cb5971e17bc3937405ac",
					"0x7d603234f8ef0a7fed0902951eed40d0ea9f66b7e86dfd3c376718344bd8b8be",
					"0x0000000000000000000000000000000000000000000000000000000000000008",
					"0x0000000000000000000000000000000000000000000000000000000000000005",
					"0x09583c56b279faae7ef3ea97a30f502ed26e0def070a0c86ce787f9f2d1e51b3"
				]
			},
			{
				"address": "0x095527f5bea113e9575b662c5ba01d990a280f2f",
				"storageKeys": []
			},
			{
				"address": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
				"storageKeys": [
					"0x1a824a6850dcbd9223afea4418727593881e2911ed2e734272a263153159fe26",
					"0x0592cb2ac66491e80183860ecffee687cbefbc41e7cfe5feea9d6831d625cf51"
				]
			},
			{
				"address": "0xec6a6b7db761a5c9910ba8fcab98116d384b1b85",
				"storageKeys": [
					"0x0000000000000000000000000000000000000000000000000000000000000007",
					"0x000000000000000000000000000000000000000000000000000000000000000c",
					"0x0000000000000000000000000000000000000000000000000000000000000008",
					"0x0000000000000000000000000000000000000000000000000000000000000006"
				]
			}
		],
		"chainId": "0x1",
		"v": "0x1",
		"yParity": "0x1",
		"r": "0xcdbf8e7aaec93d4b324bc9dbbf6bc1b49bbf5fb772502c1c6dc0a7492f71a952",
		"s": "0x628a07f8defcbe2b798db562e33199e980414358739227aee5ffb9b865cd08ef"
	}`
	var tx *Transaction
	if err := json.Unmarshal([]byte(txJson), &tx); err != nil {
		t.Fatal(err)
	}
	assert.Equal(t, tx.Hash(), common.HexToHash("0x8dc203bf6083af1877db1812523674335dfedf65aaa6f1a3649aa51ecdac99e0"))
	assert.Equal(t, tx.From(), common.HexToAddress("0x1114c78d5de672996d812dc2e1a05b5f33eacdfb"))
	assert.Equal(t, len(tx.AccessList()), 4)
}

func TestUnmarshalingFullBlock(t *testing.T) {
	blockJson := `{
        "baseFeePerGas": "0x55ea8ede6",
        "blobGasUsed": "0x20000",
        "difficulty": "0x0",
        "excessBlobGas": "0x0",
        "extraData": "0x546974616e2028746974616e6275696c6465722e78797a29",
        "gasLimit": "0x1c9c380",
        "gasUsed": "0x12f3881",
        "hash": "0x9d6ac70a2bd9cfb15ae757061639e95f83c67210fb3ef12e437c9dca6230d0ed",
        "logsBloom": "0x2e6be1e7756e417ad3bc4be7fa59eee93113c817e9196a7b5b6b1b767fbfc39509ab7dbf6aaf70adfa95fff191b247ddf6e5bb2abb3bef770e5bab6b8ffefb9e3c4bc95b4f45daff5e4fca3fce03eb2f892341206e646c46aeb78457adf579e87fb7c9d5777757fee8cfb7eac66fbd95f4143d69b3178f57ab0f64bdef5ab52c7e7bda7d3cf46782ebff7b11ea74db4fde07bf9bfff568fea3b4a8c2669616eeb32f2a665e867a8eeeffd7deeaaf5e9a24ebd378dc706f0c94dda97775f376f3787d946b04833907fb43086e1177bfe322ef1a33cdb987f7159fff17fc76f0c49dfbbc7c7b810ffedb357f81a91b3f79dfaff44eefd8aeefd981e986f8ed76cd",
        "miner": "0x4838b106fce9647bdf1e7877bf73ce8b0bad5f97",
        "mixHash": "0xb31e359a6342c715aa490f62a29492c5c9c1be9d107d7471830572627dd4805b",
        "nonce": "0x0000000000000000",
        "number": "0x12b557d",
        "parentBeaconBlockRoot": "0x5fc0e7b2ca639f1d27a9ceffc8bcbe8246e3a19cbe856d1bf0a606a1bb641a69",
        "parentHash": "0xbbe24e12d2c363703c96e8248f90933d53930fe9a410b2c6c1d1f6258fea3cda",
        "receiptsRoot": "0xee501e6ee9fe5b69698961a787864f2fba45e0701a5a981fe39da14f21feb7ee",
        "sha3Uncles": "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
        "size": "0x2f22e",
        "stateRoot": "0x433f415b60cba309ccdff54c9d5e89814289b1497e6d1d9cd7a1a51422f97111",
        "timestamp": "0x66150803",
        "totalDifficulty": "0xc70d815d562d3cfa955",
        "transactions": [
            {
                "blockHash": "0x9d6ac70a2bd9cfb15ae757061639e95f83c67210fb3ef12e437c9dca6230d0ed",
                "blockNumber": "0x12b557d",
                "from": "0x93793bd1f3e35a0efd098c30e486a860a0ef7551",
                "gas": "0x61a80",
                "gasPrice": "0x17700ece1a",
                "maxPriorityFeePerGas": "0x121165e034",
                "maxFeePerGas": "0x17700ece1a",
                "hash": "0xa57b587e411d15c93b96f5f4e8e6a0576b878c9488db851632ee2fa18b35f8e2",
                "input": "0xa0000000000000000000000000000000c3db44adc1fcdfd5671f555236eae49f4a8eea1800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000004fc451ea9efedbfd1bd00000000000000000000000000000000000000000000000073adb97f0b61f8c000000000000000000000000057e114b691db790c35207b2e685d4a43181e6061",
                "nonce": "0x3983",
                "to": "0x9def7cde171841a9f0724124ca0b01a622d749e4",
                "transactionIndex": "0x0",
                "value": "0x12b557d",
                "type": "0x2",
                "accessList": [],
                "chainId": "0x1",
                "v": "0x0",
                "yParity": "0x0",
                "r": "0x433b331c2ea701e323ac6563a052d4b20fb7061f7022e0666558ab7156435d18",
                "s": "0x55f6ab2f52031753f80f4e26265833dff71dbe9fcd19db10495e5f0866ace483"
            }
        ],
        "transactionsRoot": "0x856511abf03d74d4b7c7255d2cdb13b13be8acc48779493ea2c0ce7c313e2242",
        "uncles": [],
        "withdrawals": [
            {
                "index": "0x2766ac6",
                "validatorIndex": "0x2b899",
                "address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
                "amount": "0x11aa718"
            }
        ],
        "withdrawalsRoot": "0x67ce685c53d3a7000f4f815655d7624fb6fe80bea25b02eb4216a49567f8bf24"
    }`
	var block *Block
	if err := json.Unmarshal([]byte(blockJson), &block); err != nil {
		panic(err)
	}

	assert.Equal(t, block.Hash(), common.HexToHash("0x9d6ac70a2bd9cfb15ae757061639e95f83c67210fb3ef12e437c9dca6230d0ed"))
	assert.Equal(t, block.Root(), common.HexToHash("0x433f415b60cba309ccdff54c9d5e89814289b1497e6d1d9cd7a1a51422f97111"))
	assert.Equal(t, hexutil.EncodeBig(block.Number()), "0x12b557d")
	assert.Equal(t, hexutil.EncodeBig(block.BaseFee()), "0x55ea8ede6")
	txHashes, withdrawals := block.Transactions(), block.Withdrawals()
	assert.Equal(t, len(txHashes), 1)
	assert.Equal(t, txHashes[0], common.HexToHash("0xa57b587e411d15c93b96f5f4e8e6a0576b878c9488db851632ee2fa18b35f8e2"))
	assert.NotNil(t, block.Body().Transaction(txHashes[0]))
	assert.Equal(t, withdrawals.Len(), 1)
	assert.Equal(t, withdrawals[0].Address, common.HexToAddress("0xa8c62111e4652b07110a0fc81816303c42632f64"))
}

func TestUnmarshalingCompactBlock(t *testing.T) {
	blockJson := `{
		"baseFeePerGas": "0x55ea8ede6",
		"blobGasUsed": "0x20000",
		"difficulty": "0x0",
		"excessBlobGas": "0x0",
		"extraData": "0x546974616e2028746974616e6275696c6465722e78797a29",
		"gasLimit": "0x1c9c380",
		"gasUsed": "0x12f3881",
		"hash": "0x9d6ac70a2bd9cfb15ae757061639e95f83c67210fb3ef12e437c9dca6230d0ed",
		"logsBloom": "0x2e6be1e7756e417ad3bc4be7fa59eee93113c817e9196a7b5b6b1b767fbfc39509ab7dbf6aaf70adfa95fff191b247ddf6e5bb2abb3bef770e5bab6b8ffefb9e3c4bc95b4f45daff5e4fca3fce03eb2f892341206e646c46aeb78457adf579e87fb7c9d5777757fee8cfb7eac66fbd95f4143d69b3178f57ab0f64bdef5ab52c7e7bda7d3cf46782ebff7b11ea74db4fde07bf9bfff568fea3b4a8c2669616eeb32f2a665e867a8eeeffd7deeaaf5e9a24ebd378dc706f0c94dda97775f376f3787d946b04833907fb43086e1177bfe322ef1a33cdb987f7159fff17fc76f0c49dfbbc7c7b810ffedb357f81a91b3f79dfaff44eefd8aeefd981e986f8ed76cd",
		"miner": "0x4838b106fce9647bdf1e7877bf73ce8b0bad5f97",
		"mixHash": "0xb31e359a6342c715aa490f62a29492c5c9c1be9d107d7471830572627dd4805b",
		"nonce": "0x0000000000000000",
		"number": "0x12b557d",
		"parentBeaconBlockRoot": "0x5fc0e7b2ca639f1d27a9ceffc8bcbe8246e3a19cbe856d1bf0a606a1bb641a69",
		"parentHash": "0xbbe24e12d2c363703c96e8248f90933d53930fe9a410b2c6c1d1f6258fea3cda",
		"receiptsRoot": "0xee501e6ee9fe5b69698961a787864f2fba45e0701a5a981fe39da14f21feb7ee",
		"sha3Uncles": "0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347",
		"size": "0x2f22e",
		"stateRoot": "0x433f415b60cba309ccdff54c9d5e89814289b1497e6d1d9cd7a1a51422f97111",
		"timestamp": "0x66150803",
		"totalDifficulty": "0xc70d815d562d3cfa955",
		"transactions": [
			"0xa57b587e411d15c93b96f5f4e8e6a0576b878c9488db851632ee2fa18b35f8e2",
			"0x29bacccade7a241999fdf70fbf1b407b556db3fba5208c6cc632aec4ba836346",
			"0x9978ee1abc4f9901e4be59a0af9daf3a45565f80b288b82e8856312a55ca1e38",
			"0x4a0ce38971ee94a3c6c8e0f07288261ec5fcfb06c9dca3b948fe1ad41bf4c1dc",
			"0x11ef55698837a5f55b0a11f7fbce7851b1b6788e44cfabef72f969d125744ae1",
			"0x9f6baa95bd8b3d478a09306151b9ac5197dfe31490f0854477e3c8d2e04c49c2",
			"0xe708cbf20279cf6ceb0507037c976082c85c0b10a2df143ab4e8e0e47e1321a9",
			"0x18701b21cca2abf0531774b134905fdad2b4ead504f36de350680326bc7514f5",
			"0x558f4cb6ba1370c601b49de7403ace1380a0723a0f2477f11a3256636d43b349",
			"0xfd73aaa7127d8dfdd313b112ba968a9df5558dca306d0b0ede7bc662f792514d",
			"0xd9fa3683a6c1ffe1c9fd68011e167c2b1874398980ca872215e1e6e615cb88f3",
			"0x7bd0760c90159f62c4a5fa334bf2ded3237c756a74a2477eb1602213f61c8dc0",
			"0xce4247543cd44a4847c2fc3bffea7c96933a4dce564799e789109cfa997c4b42",
			"0x3c43466ce895f6ad4e59785d553218250fbd9ac5ee312b5746075ce5ba2e9bd2",
			"0x16b0d375194441e8e61bd7123671dd12fda6098f2ef67477c0cdd6d92f67c73b",
			"0xba648f0275281f544bade0d23127bd647aea1afd5178fb32b7112abae6d14032",
			"0x1886be4468de9d5a27a6d11000db17c3060973c250f1adb3e5dbc57982f979ba",
			"0xf2c661babdbcc6b1ca42d46a531f07d64b3dc44d910102925fc98d1d564f9b74",
			"0x9e27e9b19e64719c11475bb4757b070f590f2c13e580c87ae7c02a51404eedeb",
			"0xf074fa670e94f3c0be0bdb08c83ef0acc7b698273f5b53453d09455bb6bb2728",
			"0x75ef6fa43c2bab8d28994252a7a728a68816dcfab5b138b785b7568f32420c18",
			"0x705cc0902485e4cca4187562a5bd57b3fbde05dd40956ed332f37b26c6b24184",
			"0x7ea1a18fbf721e9707028f00fca92cd751835cd6012a51d062880998c3a259c4",
			"0x5628636ff6bdfc3e39d04ca65ea6db2333cffbf3fd1621115da5c4105c5eb43d",
			"0x0fcd3cf5204c13493fbdba82b705daa77d2b07e6a5e591032fadbf46afabf4b6",
			"0x7db8db394f482fe0a918cfb2b6b4edda29b97191804dc798d9c4b45bb61793ca",
			"0x404127df8226b61a60bafbad0a1049f059e38ac7108705225024acba18b9052e",
			"0x3089467997630f21dfba57f04c269a42871918f2ea944a1698039bf6256dfa75",
			"0x0c50381d63a4aa0a697aef2731a8fbaedf7e4537b43ed5dd3ec905dfa618ea27",
			"0xfd331e8e8a866b08ed8ce47105bbb2304b685b9d8b3b3cb9086518d117eed430",
			"0x063e37924c3f8ca7a3bb8e97417b9d709a3d046686ecaddcf8d2558d01652b24",
			"0x1ed8ae81a5216e9e8d5ff3751b149e21472918b9af82df09098e7f25ea7faf2b",
			"0x59156d03540d94c2e4b5c277d880bb0ff599dd5727b1d560387636b27dffab99",
			"0x50098910fea10c588c1b7fbe534e07e2f584a5afd449d6cda8a7066d63ffdadd",
			"0x0933b8626863b889b34eca0b608e2ab6f2a45ad0f3bec1b72a4c513ed0670684",
			"0x7a98700e449a88d1238d63f513873e0fe326a7e356666a15f5ce4a35471672fc",
			"0x08c815523aecd141e7c3aca095174388fc69b528a9216832d52cd16a650e0ff9",
			"0x10c6b029b10a4368365691d82a9dcd3c23d06edfa0cb71a0643012fe4ea5a43f",
			"0x629ab3abee58336077e6f260722951c1c78d68a7cc1a55831ac994d7a2be5a9c",
			"0x587f7352522c699b49f3b8fe15066238e4fdd73505d8b98d1e5b65362cf5fb36",
			"0x8894253e32ab20b2b738641db70e855028a5e72ef928b27c2b75b4ba7482b459",
			"0xcd18af7d0b11ab47cf80ec23f51ff03360b50707ae80d4c5acd3619f4065718d",
			"0x847f52fe900b331a6a340b90ece88acd188c2c006635d3283e7687b17ea8cbdf",
			"0x12e3263e822e62f7823d8b0faf990338f313cd852bf2ab034e1697739dd2a520",
			"0xca5ab2f35d184938e83af61db4c80201ed87ddfc5455b0ad85282539cf3ca86b",
			"0xa0dae29511826fa54a7b913f4aacb123befc733556522961c68611665eb9dbfd",
			"0x931f7f21c720e97b7611c88d073064b2073628ea3dbb64e8cdca57449bf574e2",
			"0xd69c5df22fe924003c6f4ac3ac74cd5c5b871bf1f010d759217c9fa6708bce60",
			"0x0d376bcbfdcdffd19345a754956f7d82bbc26ed268dd232e1284d5cbe7036f88",
			"0x97a969622abcc7516c46a1009d49a195ea208e4fc3ca0bebe117ebb0e861f532",
			"0x03f40c11bf47b0545af447863f0b50054b4e2fa7e0a9d0661a5188ea1dc74c9d",
			"0xc4b7b87541047b7f8ac2bd3338f073dc7dab38316ce17da1d5c1465a3fdddd50",
			"0x0c1435aeddcad20741ad24c86697132cdb043a2bc698de133ffd4087ec6774aa",
			"0x6e38304c0ddb58835a7b24550434c403b5a9025dc661bbf223f95f06b6158aff",
			"0x404af48153d44c7f78140653eff32777896ece57805972adc04a694b1f293205",
			"0x1e7c43b27420c26c537b5e2b190a23e782d0488d722cb76be32d26cd93871489",
			"0x1866c0c9725afb8155455264cb7d06d8601c00dffa5fc435270cbe38b73fdc3b",
			"0x230b36c94f1c072d940df224cfacf1813c007799efa33ded6ab8a99722bb9aa2",
			"0xcb95ec4cf053a8f7d418c38cb45a3d6cd80a11fbfa9babe723eb44a68a54e37d",
			"0x91aaa9093feac91b18b97f1042a29f646152fd7bf60f9c879d4556224bf0d440",
			"0x4903879d738127a3f696a8e92703d8ff3da0176a2c7844cdfd9c68d057c9f250",
			"0x3ab993df4e7429849e48cf7fa6fd6bd809240aa4f6e8b8f47ee8e27c25ea4973",
			"0xd63f0f17eaa017f527c5242d430c4e5a0cc0ba584bc34fef489c16ba554b93df",
			"0xfa9db9868eb069e6550bcefb2ff9747487e9f6a598a5cac4ffd92d99e63fba5d",
			"0x8dc203bf6083af1877db1812523674335dfedf65aaa6f1a3649aa51ecdac99e0",
			"0x4ca25d64a91f1c308a92129c077899a5393175d972286c15b652a5379898ff70",
			"0x39451dde265aeefd171ee78ef7c9915e5a83440219a92c4052f1c6f52d090b12",
			"0xaaa3e1175c656c2b69c870c9a684ac8b6b9c2badb3932ad5fc37f158df0ecc9a",
			"0xf9dfe3a0b808ff27f25ffd4f3882afc827ed4602adac47554bbe116398c6bab0",
			"0xf74915bec20b83fbf23d96d2f512796b5e8d41d4ec07fc23cf0da9b6f4bc607c",
			"0xaea8ae81136c13923569c3a4544f713b76ecb7d8cb8b8e6f68b4c0853d2c29f5",
			"0xdd27216041849c00baf14c5799b20837aa56b9c3ecb34e21a3224290adebaae8",
			"0x9dcc04297ca0a21fcaf5533e50f3d73127cb63ac72ba6a6534859001e47467e9",
			"0xa45e2330ff37ba44e938acc9faaeaa2b1e6b582adf3ee0eb254426d4bfbe706e",
			"0x6db7e516ae247f6fbb8ef2130bcbb1edab47ab6ef1296dcb98aa902a258d119d",
			"0xb7393dae966178f56d698296b97d66625c602b62724cf87e3c2dbf044d4ac9a2",
			"0x2bceb9717585f716db169d67c6464052daf9a97af98e081d90dbfe4fef323e91",
			"0xaec61dc6d943cb9473a9415db56a697d2fcb8e095c25d08139e54ff4ff73d042",
			"0x5b64557af29b07b86ec48a7b9fff64fa8bd3ca571f579bf5dea832ca2dff37e6",
			"0xf35359bde231731ac869cd24b23d3424db455298c335102db536a98c638322a4",
			"0x86135f61e209666d865bd1cd7c2cc4a986f1bb37fae15eaad5deb0eb55c28b1a",
			"0xf79ded5dab635b3179b1a6332eb3bed1333118e4fa5b2077bfb66aeef3faae7d",
			"0xa44223f90161772e4d591906e5bdff7a4286e4e14f5de2d43e0f957f00fef6a2",
			"0x0f9fab1d3816e088f51d631de51b48d93b2cabb76a28af5e1780ce5a8792330d",
			"0xa262028aa6ffb115ae199119b416b1de08188d1b7a3249aa476a7dcc8206eb15",
			"0x041b19fbd110d64c3f1e128999e51d312811f3fbdd5facc36e87d7397686793f",
			"0x50c2001247ec99ec123bd111ace0eec6e9b3a9c9143e95755944108ea57dfc2d",
			"0xac34f5b359d19ff956f3b6e124cfa18be8460459fc52d9b3a0f71ca61d49c024",
			"0x8f5b41a3c6d2dc4cc3e3fa70f382968d320ae34aa53d0787efa4def73ab736a0",
			"0x213801e651032b8423da725955ba724c61d6a3cf511a57c8b1dd1688cfe63226",
			"0x7616d8e47e439e9fa120f33a588b5745d9bad6fde39f332b14675debc7e0a3cd",
			"0x508675ec44dd0ad936b90811a1dcf61cd5897f895ecda6ebe87f8bb79527c265",
			"0x12c4702ca537d02b3b20afcb0aa5304319e2f09e341f634b8fab5f142ee8f28b",
			"0xfdb5a04b7a296f205000052734b783164926db4eb77c79694ed3dfcb4632c08e",
			"0x83bd6c3c7119357d1b3012498c4bd3089f87a5f59e96df6fa9285ec839e0df1e",
			"0xb4e97cec50dd2e9dc402f823555387ed8b6cd8e48b4de99be19acc8963ee7192",
			"0xf938603badbbcd475e2bd3d70441ea962e0d45e8c4cb06069f7e4aaf3faa550e",
			"0x42b222b2e0774526a7cd873d835dcbec76e2877d9b7fcd7ecac0de3d57d989ea",
			"0x214b30063112dbe7403fda75d825e561c647461d01dfda9630ac4de262961ce3",
			"0xada6323490475d8984dec590920e0a276104435836e0a292ee366b3b926ffe11",
			"0x0d83d22bef8f0abe18fb0784e2dd62210b5647aca32b435ca4b9c5a85e8287b4",
			"0xb1950622144834912b2d9907a84904de9f9dea76d9376bbfad91a2d50c88eaae",
			"0x8bcf61bd239f65c435e3f4df402b10f891f53130ab758d268f781ed49aa2badc",
			"0xf091b57e95e06c2582d493396bca1b4790710151475e125a777ac593a492b99e",
			"0xcebf18d8bb376048ab991c638bdc0f7113048eed21ea883acc18e59e2a73327f",
			"0x2c708cb20add34f5f908e983771a2e433f9e8a66ff98356861697ad434f0548b",
			"0x9caa579f992b1aadfbb1ab1fc70b42a2442596a31637081d4d99631bf4ba5ce1",
			"0x68a66b7742d4232b53467152c3f65f2a689dcb81af6e7bdc8fb53edbb92cd003",
			"0x22d05153698bf8a6e229377d4e7baab1cf09732d3ed15a163e816f06057ba9ce",
			"0x0b01534c49ee1324320d5b3f2ce712d594e1620ea0b4cda01e50296b7fe937a4",
			"0x5199a0d72122d5b1708055e44947a5ca644c2f86647bdc2a5cccf376f042c5ae",
			"0x6363cc6741fae001d0418235d01b2ab8fa0a1bae7206cff8f5d2ca5a3e070704",
			"0xcdc035767ef6ca20c724e6904f0f6287cc30ce507cbd29296770570337642cda",
			"0xf3c03d78a9510f04c40c9f44bc1ac91da3a860e0d6eb01e8738b6f545548a8d8",
			"0x8a720900b0350d34512ad35edd9874f99eae1de6a26d56bb6dc39573e6a37d6e",
			"0x68735a9ab782ba48ed44247ea8dc7fa0ef771b3e4893ded63d6e07870cb07bba",
			"0x752fe1a04d7733fd3f495ba82ed3eca891fd2f3d1cb54a3cba8aaee3f01c814f",
			"0xc12c190b35a533a8d225954d4c6f8b2264fd5d2bbd02b5c4b3e5ac8493a09221",
			"0xf391415e0bf9bf86ddd8a2cefe24edc525e79a28fff2689ef1e9917e00f278be",
			"0xe108d472fd7b8b7e399e6a8a0b3809ecf0abd9c1e8ad7d5ff547c26c8dd93cd8",
			"0x1e55bef8ef0578294c675e57fc416995df39cfdbe18c92141b873a95e66a7a6b",
			"0x36e98306b93d501bb45c7bf76a6560d21dc12dc270d1a06b2279f7623f2b4131",
			"0xe3fddba3597aa896f0f48fff3a7ed14552a6987697952aa67df13f8afd93d351",
			"0xabfb9795a76e2fff4a5b7de8d46a02dada4ea5d9eafd9857467083c7868f1d39",
			"0xaee7c53887c8ce735fbe425fab0a7895319205a40f9441495a0e1a57ffae173a",
			"0x2c24fad0ba2bcadd587d29b938a88962bc99e6941a205b8af0cf02ee1248190f",
			"0xfe30425b98dc369fc3a44cb80429d8e098815edb4c14fb519b1bb7ef56cf31b4",
			"0x5918bd40627cb9b3aaa05141af6ff6b8a07893295cc8bb9145612fa618c42985",
			"0xad080e2213914f879245270ccce74773424c87e78d345e828696dca898ecfdd2",
			"0x90e172cd4f021fac264bb0f255a080541f10481bee5bc794fcfa0bd72dce9513",
			"0x86ec1745421dc0a8275d0c2e28a36321d142dbd0149ae43a8c62688c6d2b2245",
			"0x22cf640740b1a021ddba3e8456e09daa05c839e37befcc74166b00af9992eb9b",
			"0xcf71a503e69513b475106331eca5d449bcd5f861c62c2831eb235504eee6dd32",
			"0xc2032b7b093df220058fd90d2e463ca5d0f33e2e1cf8704841854d72f6a7af0d",
			"0x3e4a93512af0184da9ee3214f5899ead7ef3a450d7af1fbf9d9deff4b003b762",
			"0xdf851caac642206d7f62c2a66a5841fd60015843f23bb848e61b206a934c7fb2",
			"0xecfcab2bd39c9e1f598ff82a5d0021a9a52c8384e42c68f4d0a916d7f604bf9a",
			"0xef4385a463cb36886c84706159919223df4f5f09fdd6c628a398df4a0cb684bc",
			"0x2a1986807b7d86d2dec92c2e059c1f92aacda83191c03f036de8d9173952eecc",
			"0x575cfc5e1149c045f817ab31c1e5801bcd21939d551343728e9b248898213326",
			"0x94c1bab0a8b5ac4e7c5d6dd0003f56e89df6ece15fccc0316c5667db16fc857d",
			"0x4fe7ad480d3f3c3c7be8f1a98455d2d5cd267d670c8959967f9294db17d9f538",
			"0xbcfb721419ab5c65f9bfe1f7ee278131b789656fcd2f537c59cb524a1915fab0",
			"0x42292c129c4550cf787b267b4731bddaeff1949a72830345a0ce998356659797",
			"0x43ba6214e637bcdc6138b556aa5e0435aad073ef7f1ae492c5e1654e43d9f6b2",
			"0x06252ba9c224ab2f7784a26dd5c6dd243c5d27692960efd42334a1bd2e2aa87f",
			"0x3409458a6cdf04d7ceffee9d33adaeee67deb0cd084446275e5d0f2700aaacd7",
			"0x8e8b565b6f373f95cee16e92f8e064e11568a05286f7343700c33b0d3aea3318",
			"0xee45fd130ebe5c44649cbd1027377f5df805f5e89903185564d255224a991cc3",
			"0x50be889c78db86be23dc9bb0af438d4b53e2a800076705855252ae8ac3bf1985",
			"0x925b4ec9fd824516791190d8d2305b102fe461ba64052eb6262e75b653380cc1",
			"0xd421de977a6f7be9f96771e7444cefe598a956fda265aa1a23d6e2951a68dd53",
			"0x168cda4b68f2e8b5ac60537af84d0df4fba62a5f635809b51b4f6d3ca4403815",
			"0x4a7dc856647f12727fbf1a5bc7c28418a6aa6c5f0daccbd1b34b80f66cc50400",
			"0xd27f09dc486461bcb1968465c2e896f035476149334bebbea1278b42f11209a7",
			"0x85a0287398399f431d3e528f4d11aa8b03490a5140160cc38089b6e94bacf4d7",
			"0x732fb4911b4157c2c4761b5a6b615d9933af0adec640b2949b195a976e18bc32",
			"0x006d76328638f143681522ef603c9ec05a964f9d11b188ec5c6b17f6d3846c19",
			"0xfd3ff4d2383d62950de7a2a17689159cce5082238b52ea454677b10dd874bee2",
			"0xbdad0db219f07eff1c3fb7c0b9782a86522b09480bc8314f0095d0a354a78fb4",
			"0xec468151a7471323c0de0b97fea0843c7eeaf227cef32356686e71765842d895",
			"0xd8adb10313efed36c006763162d5d463a5a8226d7cc2971a0250f81590d8eb40",
			"0x69ed2d5fc34034663e1ff6930c505f1434d3c1fd9a6bf8bedc500f5d7b7f7cb8",
			"0x03446eab4f900a2582de8bba5601dcca055f3f0c18049903011410556cfbbd99",
			"0xb56ee0602bda04abf99acfb81e08075b8dc4cd37fdf496ab3b4a6b0b2686a012",
			"0x97df15570d433a36010376a4a79462dea93de6d0559105cd0184f3be7383c37a",
			"0xc02dfdd2178329e01fc4a0f9b382bd236f223f13399b49094c0aedb0c9e3732b",
			"0xe2116a878dfb66d2fd03805806612eb05a4cba056313676cd8ee7f4075b75948",
			"0xbf38eae41cef65ad9ca6389f40b5535356131390c6b9e7b214e960def7c24a2e",
			"0x614d50c145dc56df4ed8bde3920d4f7d74350af87ba2d9949377eafdb09d1565",
			"0xd41bba4567a830a492e3abaceef69dd993c25776532e696afeca596a0fe16672",
			"0x734035432e753306ea90defd65c1d93cd6b450706d4a888b09a59334f0802471",
			"0x560748548c75a4b49391b3384c400d7ead312e944a1e9f41cb144f1b729d44a5",
			"0x9547516e3fc4b022423eafd7ef50868780a5ad74e061eef8e9ce9d4140cb656b",
			"0x505f2a1bc837530b8c844e676248c4486a58291c264e4c9156c3cf240c3274f0",
			"0x692cbfc6ef28644a41e4bf1b7293663b39d594e3fb47dfe19b7f110bbfc9844f",
			"0xacdb3aff0be5ac6198325692242f8dea0e1479199180091e80ef057723b5d075",
			"0xd05ce29df222839a153f93738e8fc60f826874ff2863da4396c5a1879f0a1fbb",
			"0xfb413defc09d068bf420962575801805cd850fd7a12e3a3ac2c94dce317ea5b8",
			"0xbedc6af412b060a5c6905ee48e7b8089bc4fe344f728f33e6dab9e539dc8d3fe",
			"0xb8d8080290ff1facf2878e6bd6e25010a763508e8210c100a10b3433422e60ae",
			"0xccd4076459789837f7b7e9f5312e44904e790f821d55d1770fc78b6f168b2622",
			"0xa849573ff7a0c4f381c90f46cfaa61556e9634cc54529260bac5a5d233e3ff4d",
			"0x436fd01c8c61043ac0f6e4e1df53640d5074ca65318fca564c5f32fddf814923",
			"0x2b9b2baaad4ca5957033221eeb7c4195ee74dade60f06229f3d2768768f1dac0",
			"0xd307d14c859554cc3e90d37da1bf566f67cf054cce8bbeeb07692a8aed6d6040",
			"0xeba77c79293c59c087d3a4486d31faa69fed8c69766f49e55120ce5b5b078362",
			"0x8e674eeba068778f8be218885da43a673a2aa524885541457443283291c0ef01",
			"0x4cd31207b2640230183f9f4e2703e353273a1907772449b21c75229d4c826f8d",
			"0x379e3f5d9a2b6ce0d289815ed5d2b7ed64353ade3000b4dcf2597f59baa8ce81",
			"0x108c1c1bf91e23082f1e8c2085a70fd712a58df9fb0cb002d097e9901ee530d0",
			"0x84eec519c6d794ddf97214400e1a6c85e7f504e1dac280eed7caa3fc81e26215",
			"0x4f5218cb59663c8ba389f249e082f6b2ccbff665b64233a8df5fc911fe1520a0",
			"0x9a5b33b16a3d9248f87051c51398177f30fad50a8d9ffa64e5ba859a2d5169eb",
			"0x584b224582d231b41b6af6e886e7f254d7552646c69a5b824c695acc7449704a",
			"0x6436defc168dbada4849f68f94063200dd0abda2dd2f17213bcf305caf939b92",
			"0x9cd42ff318cc4704667f208dce6e15bc31d63b4148223abb605434de375fd78e",
			"0x4afdd96c7c138366b061686b42743b468e73db432a0f824bc0a58b7f43dd1b35",
			"0x594dc51b72c029732724c3bc2226ce33b797fcbfea3895e0a476dd577718d269",
			"0x05c7742bb3479df43c249737973875a4381cdf4bd1a5282f067eb520bbda1d10",
			"0xee890139ce8f4dafe47e8b5c8d1c1f26ae37c534eee8ffadfb27515bfa00088e",
			"0xcbd0d908df0d9a4c8a93975cc3a1edd0712aa832ae5e0fc58b753fb2fbb257f6",
			"0xdbb732740f969e3518ae7e270d0a2b8599219ab38fa36e42335d69e5dccb5787",
			"0x4ac53292f2a9357c6c12c4323bc077dda2acff0b1a56bd40e4aca8ce8fd0b7b6",
			"0xf1c684e46c38b017fbdda6ee4c874db9a856c3aaf7e7d04d8cb8286b5ff00a07",
			"0x23bce93c6bf25598d7a2d85f3d6d4b3bbf631776ac25a4a584c809271f296af7",
			"0x9c8693561b603c467605af379e8b618f5aeac5e772d30d8b11e882f79e156072",
			"0x47110d0c52f1c5e298aa673bda3fb9e2a70f0250f3086a23124ae6ddee4a48fc",
			"0xaf900606abfb9d4d00e0bb3db0b1f5c75311c393eabdf39dab269eb8caa5f32f",
			"0xbc5eb48b860cc56ca6b52f0b93d034b3e2adb7e3f4fa5d98f62f68c92f6d147d",
			"0xbc5028973a35e9381dce370efa62cc9bc8805fc005e725a216e12b09622a164f",
			"0x1d04a97f131e6510eb148be2b2d5b5b64f0ddadfded8af4a68b3a75581324969",
			"0x9f746be06aa6e04772a9b61fbd0f4b1546dd7ff94034511bc82ff398cbb78361",
			"0x1977b97b98912394bc094431bb294573c06eab2c12379f5543475f292cc6d664",
			"0x16db6086734ccdb6f89370ce00a5520ef3979ebb2f9aa85a11c7dec3fdd256ea",
			"0xbc9c10dc054cd247d00b479e53c6e3bdb77e69ea824a2d12d2385aeb2f919169",
			"0x64b398e364cbdab87453251791bbf0ade6307e9f41a046dba05411d27a79e77f",
			"0xf733941d2333668307a74150723525a3c0411a0d2d16e516aade5b6c7fe2fc8d",
			"0x58f34ff6864f40ce6088db4311db44ceb3a536e9bbbaa1364489b077229d7ac6",
			"0x8acb8f1101404ac3dd1838e43a84e3210bb8b3b570c4be6401d3f99f4d8aff2f",
			"0x3dbdf615f7be6bed3d02fa88210c59334385d6b10f7b9b694242187a8b2f195a",
			"0xfc4c16b5d6d4e1e473434044709f54e554b63fa7af7a2bb8e019fdaf90d244a6",
			"0x7209737fdf25f7f883ac5a26c93460d8beb8417c3bcb38d5afe58430f2d81e79",
			"0xef2ae8e292310afd2c7e6cdcbe786245ac221d6bfc97a5ab5a8de169a7350a2e",
			"0x7a1c138250ba7c6da1c121bc1cad39c173905e73e7733161c9d4b6e6575e4a50",
			"0xc80c464d134b5e0eb0c0629f15eb2d49feb2a93aa55cc65650241297cd31a0ca",
			"0x07b5e55b2fce37b03dcc82b2bfe4795d0c5b4c89397b0beed683c25bca118e1e",
			"0x11e2cb62887266c6e5cd3e13714050765df29723db4669b8de8c99a5e10a8aca",
			"0xae488e372affca1241e579633a71a013caee72b6768f9026176af4194bce5be4",
			"0x395a9daf55eb9b22341ebaf9a3e5cce5e82904039cd0f0f4b7c12a6ab8d520e5",
			"0x40ec3c1dfc26115b827d55339f180034ca0dd8efc9a61ae4082f7b3e38b63772",
			"0xbf7a6475e3a167ed157aadd92e9d365e3d45439464b7f700468732f049b8d86a",
			"0xd2dad0a8929013db739e938cc65bc46fa2d018fb27e0bcb1b9f54b1e2d5f1aed",
			"0x03528f3a37d060a0aa018f2736599fa6ddc586acbb590e50e54f712c730c3fda",
			"0x37a7b2d2d7b7926fa448c91c74dcd8a68db7d2a8cf64d3d2095680b16028d647",
			"0x4ca0fa8d1ac2a80aee40fff997cf36d9e550644231bcf560f5c4ad3efdea9c68",
			"0x81375d23f462fb96608831faa7f402f7a513755478b62ead6a8bcd64a7102f38"
		],
		"transactionsRoot": "0x856511abf03d74d4b7c7255d2cdb13b13be8acc48779493ea2c0ce7c313e2242",
		"uncles": [],
		"withdrawals": [
			{
				"index": "0x2766ac6",
				"validatorIndex": "0x2b899",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11aa718"
			},
			{
				"index": "0x2766ac7",
				"validatorIndex": "0x2b89a",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x119d95c"
			},
			{
				"index": "0x2766ac8",
				"validatorIndex": "0x2b89b",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11a1eea"
			},
			{
				"index": "0x2766ac9",
				"validatorIndex": "0x2b89c",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11ab47f"
			},
			{
				"index": "0x2766aca",
				"validatorIndex": "0x2b89d",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11b162b"
			},
			{
				"index": "0x2766acb",
				"validatorIndex": "0x2b89e",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11a8b4a"
			},
			{
				"index": "0x2766acc",
				"validatorIndex": "0x2b89f",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11a9bfb"
			},
			{
				"index": "0x2766acd",
				"validatorIndex": "0x2b8a0",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11a52db"
			},
			{
				"index": "0x2766ace",
				"validatorIndex": "0x2b8a1",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11b75e2"
			},
			{
				"index": "0x2766acf",
				"validatorIndex": "0x2b8a2",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x119c77b"
			},
			{
				"index": "0x2766ad0",
				"validatorIndex": "0x2b8a3",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11a67af"
			},
			{
				"index": "0x2766ad1",
				"validatorIndex": "0x2b8a4",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11bdfe3"
			},
			{
				"index": "0x2766ad2",
				"validatorIndex": "0x2b8a5",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11a110a"
			},
			{
				"index": "0x2766ad3",
				"validatorIndex": "0x2b8a6",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11a47df"
			},
			{
				"index": "0x2766ad4",
				"validatorIndex": "0x2b8a7",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x119def8"
			},
			{
				"index": "0x2766ad5",
				"validatorIndex": "0x2b8a8",
				"address": "0xa8c62111e4652b07110a0fc81816303c42632f64",
				"amount": "0x11a823b"
			}
		],
		"withdrawalsRoot": "0x67ce685c53d3a7000f4f815655d7624fb6fe80bea25b02eb4216a49567f8bf24"
	}`
	var block *Block
	if err := json.Unmarshal([]byte(blockJson), &block); err != nil {
		panic(err)
	}

	assert.Equal(t, block.Hash(), common.HexToHash("0x9d6ac70a2bd9cfb15ae757061639e95f83c67210fb3ef12e437c9dca6230d0ed"))
	assert.Equal(t, block.Root(), common.HexToHash("0x433f415b60cba309ccdff54c9d5e89814289b1497e6d1d9cd7a1a51422f97111"))
	assert.Equal(t, hexutil.EncodeBig(block.Number()), "0x12b557d")
	assert.Equal(t, hexutil.EncodeBig(block.BaseFee()), "0x55ea8ede6")
	txHashes, withdrawals := block.Transactions(), block.Withdrawals()
	assert.Equal(t, len(txHashes), 237)
	assert.Equal(t, len(withdrawals), 16)
	assert.Nil(t, block.Body())
}

func TestUnmarshalingReceipt(t *testing.T) {
	const receiptJson = `{
		"blockHash": "0xfd64e24e5ab820febb3d6a3a4f88482d8e6bda410179eb653ea68ccac5dce28f",
		"blockNumber": "0x12cbb27",
		"contractAddress": null,
		"cumulativeGasUsed": "0x4b5049",
		"effectiveGasPrice": "0x16e8db6fb",
		"from": "0x0f102a3ee067b8d027dffa233fdfed1f2e8a945d",
		"gasUsed": "0x1b9a3",
		"logs": [
			{
				"address": "0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d",
				"topics": [
					"0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925",
					"0x0000000000000000000000000f102a3ee067b8d027dffa233fdfed1f2e8a945d",
					"0x0000000000000000000000000000000000000000000000000000000000000000",
					"0x00000000000000000000000000000000000000000000000000000000000000af"
				],
				"data": "0x",
				"blockNumber": "0x12cbb27",
				"transactionHash": "0xeee3a5da430ba4a5ae7f154092206e5200dea766baa1d8d95d01bc953d468e4a",
				"transactionIndex": "0x44",
				"blockHash": "0xfd64e24e5ab820febb3d6a3a4f88482d8e6bda410179eb653ea68ccac5dce28f",
				"logIndex": "0x6f",
				"removed": false
			},
			{
				"address": "0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d",
				"topics": [
					"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
					"0x0000000000000000000000000f102a3ee067b8d027dffa233fdfed1f2e8a945d",
					"0x000000000000000000000000098c063d6308cd47d2d67ca17733c34f91dec0af",
					"0x00000000000000000000000000000000000000000000000000000000000000af"
				],
				"data": "0x",
				"blockNumber": "0x12cbb27",
				"transactionHash": "0xeee3a5da430ba4a5ae7f154092206e5200dea766baa1d8d95d01bc953d468e4a",
				"transactionIndex": "0x44",
				"blockHash": "0xfd64e24e5ab820febb3d6a3a4f88482d8e6bda410179eb653ea68ccac5dce28f",
				"logIndex": "0x70",
				"removed": false
			}
		],
		"logsBloom": "0x00004000000000000000000000000000000000000000000000000000000000000200080000000000000000000080000000000000000000000000000000200000000000000000000000000008000000000000000000000000000000000000000000000008020000000000000000200800000400000000000000000010000000000000000000000000000000400000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000002000000002000000000000000000004000000000000000000000000000000020000810000000000000000000000000000000000000000000000000000000000000",
		"status": "0x1",
		"to": "0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d",
		"transactionHash": "0xeee3a5da430ba4a5ae7f154092206e5200dea766baa1d8d95d01bc953d468e4a",
		"transactionIndex": "0x44",
		"type": "0x2"
	}`
	var receipt *Receipt
	if err := json.Unmarshal([]byte(receiptJson), &receipt); err != nil {
		panic(err)
	}
	assert.Equal(t, receipt.BlockHash, common.HexToHash("0xfd64e24e5ab820febb3d6a3a4f88482d8e6bda410179eb653ea68ccac5dce28f"))
	assert.Equal(t, receipt.TransactionHash, common.HexToHash("0xeee3a5da430ba4a5ae7f154092206e5200dea766baa1d8d95d01bc953d468e4a"))
	assert.Equal(t, receipt.From, common.HexToAddress("0x0f102a3ee067b8d027dffa233fdfed1f2e8a945d"))
	assert.Equal(t, len(receipt.Logs), 2)
	assert.Equal(t, receipt.Logs[0].Address, common.HexToAddress("0xbc4ca0eda7647a8ab7c2061c2e118a18a936f13d"))
}
